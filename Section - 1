ðŸ§© SECTION 1 â€” ANALYTICAL & BUSINESS-ORIENTED SQL

Customer Lifetime Value (CLV)
1. Find the total revenue generated by each customer and rank them by total spend (top 10 customers).
1. with cte1 as (select customer_id, sum(revenue) as sum_rev from orders),
cte2 as (select cte1.customer_id, cte1.sum_rev, dense_rank() over (order by sum_rev desc) as ranking from cte1)
select cte2.customer_id, cte2.sum_rev, cte2.ranking from cte2 where ranking <= 10

Customer Retention Rate
2. Count how many customers placed orders in both January 2024 and February 2024.
2. select count(*) as total_Cust from (select customer_id from orders where  (month(order_date) in (1,2)) and year(order_date) = 2024
group by customer_id
having count(distinct month(order_date)) = 2) as both_cust

Cohort Analysis (Month of First Purchase)
3. Find for each customer their first purchase month and the total number of orders theyâ€™ve made since.
3. with cte1 as (select customer_id, min(order_date) as first_date from orders group by customer_id)
select cte1.customer_id, month(cte1.first_date), count(orders.order_id) as total_order_since from cte1 join orders
on cte1.customer_id = orders.customer_id group by customer_id, month(cte1.first_date) order by first_date
 
Repeat Purchase Behavior
4. Find customers who have made at least 3 purchases, each more than â‚¹500.
4. select customer_id from customers where revenue > 500 group by customer_id having count(order_id) >= 3

Category Prefernce
5. For each customer, identify their most frequently purchased product category.
5. with cte1 as (select customer_id, product_cat, count(*) as cnt from orders group by customer_id, product_cat),
cte2 as (select customer_id, product_cat, rank() over (partition by customer_id order by cnt desc) as ranking from cte1)
select cte2.customer_id, cte2.product_cat, cte2.cnt from cte2 where ranking = 1

Spending Growth
6. For each customer, find whether their spending increased or decreased compared to the previous month.
6. 

Churned Customers
7. List customers who placed an order in 2024 but not in 2025.
7. select distinct customer_id from orders where year(order_date) = '2024'
not in 
(select distinct customer_id from orders where year(order_date) = '2025')

Customer Segmentation
8. Categorize customers into tiers based on their total spend: 
Platinum (â‰¥ â‚¹10,000)
Gold (â‚¹5,000â€“â‚¹9,999)
Silver (< â‚¹5,000)
8. select customer_id, case
when sum(price) >= 10000 then 'platinum'
when sum(price) >= 5000 and sum(price) <=9999 then 'Gold'
else 'Silver'
end as customer_category
from orders
group by customer_id
